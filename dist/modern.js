import{Component as e,useRef as t,useEffect as n,useMemo as s}from"react";import r from"prop-types";const i=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,a=new WeakMap;var o;const l=((e,t)=>n=>{const s=t.get(n);let r=void 0===s?n.size:s<1073741824?s+1:0;if(!n.has(r))return e(n,r);if(n.size<536870912){for(;n.has(r);)r=Math.floor(1073741824*Math.random());return e(n,r)}if(n.size>i)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;n.has(r);)r=Math.floor(Math.random()*i);return e(n,r)})((o=a,(e,t)=>(o.set(e,t),t)),a);let c=null;const u=((e,t)=>()=>{if(null!==c)return c;const n=new Blob([t],{type:"application/javascript; charset=utf-8"}),s=URL.createObjectURL(n);return c=e(s),c.setTimeout((()=>URL.revokeObjectURL(s)),0),c})((e=>{const t=new Map([[0,()=>{}]]),n=new Map([[0,()=>{}]]),s=new Map,r=new Worker(e);r.addEventListener("message",(({data:e})=>{if(void 0!==(r=e).method&&"call"===r.method){const{params:{timerId:r,timerType:i}}=e;if("interval"===i){const e=t.get(r);if("number"==typeof e){const t=s.get(e);if(void 0===t||t.timerId!==r||t.timerType!==i)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===i){const e=n.get(r);if("number"==typeof e){const t=s.get(e);if(void 0===t||t.timerId!==r||t.timerType!==i)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),n.delete(r)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:r}=e,i=s.get(r);if(void 0===i)throw new Error("The timer is in an undefined state.");const{timerId:a,timerType:o}=i;s.delete(r),"interval"===o?t.delete(a):n.delete(a)}}var r}));return{clearInterval:e=>{const n=l(s);s.set(n,{timerId:e,timerType:"interval"}),t.set(e,n),r.postMessage({id:n,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=l(s);s.set(t,{timerId:e,timerType:"timeout"}),n.set(e,t),r.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,n)=>{const s=l(t);return t.set(s,(()=>{e(),"function"==typeof t.get(s)&&r.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:s,timerType:"interval"}})})),r.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:s,timerType:"interval"}}),s},setTimeout:(e,t)=>{const s=l(n);return n.set(s,e),r.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:s,timerType:"timeout"}}),s}}}),'(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'),h=!!window.Worker&&"undefined"!=typeof Worker,d={};d.clearInterval=e=>{var t;h?(t=e,u().clearInterval(t)):clearInterval(e)},d.clearTimeout=e=>{var t;h?(t=e,u().clearTimeout(t)):clearTimeout(e)},d.setInterval=(e,t)=>{h?((e,t)=>{u().setInterval(e,t)})(e,t):setInterval(e,t)},d.setTimeout=(e,t)=>{h?((e,t)=>{u().setTimeout(e,t)})(e,t):setTimeout(e,t)};const m="object"==("undefined"==typeof window?"undefined":typeof window),p=m?document:{},v=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange"];function g(e,t){let n;function s(...s){n&&d.clearTimeout(n),n=d.setTimeout((()=>{e(...s),n=null}),t)}return s.cancel=function(){d.clearTimeout(n)},s}function f(e,t){let n=0;return function(...s){const r=(new Date).getTime();if(!(r-n<t))return n=r,e(...s)}}let T=0,b=0;function w(){const e=(new Date).getTime();return e===T?(b++,1e3*e+b):(T=e,b=0,1e3*e)}function _(){return Math.random().toString(36).substring(2)}function y(e=0){return new Promise((t=>d.setTimeout(t,e)))}function I(){return(new Date).getTime()}var A={create:function(e){const t={messagesCallback:null,bc:new BroadcastChannel(e)};return t.bc.onmessage=e=>{t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close()},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(e){return Promise.reject(e)}},canBeUsed:function(){return"function"==typeof BroadcastChannel},type:"broadcastChannel",averageResponseTime:function(){return 150},microSeconds:w};class E{constructor(e=6e4){this.ttl=e,this.set=new Set,this.timeMap=new Map}has(e){return this.set.has(e)}add(e){this.timeMap.set(e,I()),this.set.add(e),this._removeTooOldValues()}clear(){this.set.clear(),this.timeMap.clear()}_removeTooOldValues(){const e=I()-this.ttl,t=this.set[Symbol.iterator]();for(;;){const n=t.next().value;if(!n)return;if(!(this.timeMap.get(n)<e))return;this.timeMap.delete(n),this.set.delete(n)}}}function M(){let e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function L(){const e=M();if(!e)return!1;try{const t="__check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var k={create:function(e,t={}){if(!L())throw new Error("❌ localStorage cannot be used.");const n=_(),s=new E(t.removeTimeout),r={channelName:e,uuid:n,eMIs:s};return r.listener=function(e,t){const n=e,s=e=>{e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",s),s}(e,(e=>{r.messagesCallback&&e.uuid!==n&&e.token&&!s.has(e.token)&&(e.data.time&&e.data.time<r.messagesCallbackTime||(s.add(e.token),r.messagesCallback(e.data)))})),r},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((n=>{const s=e.channelName,r={token:_(),time:(new Date).getTime(),data:t,uuid:e.uuid},i=JSON.stringify(r);M().setItem(s,i);const a=document.createEvent("Event");a.initEvent("storage",!0,!0),a.key=s,a.newValue=i,window.dispatchEvent(a),n()}))},canBeUsed:L,type:"localStorage",averageResponseTime:function(){const e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:w};const D=new Set;var O={create:function(e){const t={name:e,messagesCallback:null};return D.add(t),t},close:function(e){D.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((n=>d.setTimeout((()=>{Array.from(D).filter((t=>t.name===e.name)).filter((t=>t!==e)).filter((e=>!!e.messagesCallback)).forEach((e=>e.messagesCallback(t))),n()}),5)))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:w};const S=[A,k];class P{constructor(e,t={}){this.name=e,this.options=t,this.method=function(e={}){if(e.type){if("simulate"===e.type)return O;const t=S.find((t=>t.type===e.type));if(t)return t;throw new Error(`❌ Method ${e.type} is not supported.`)}const t=S.find((e=>e.canBeUsed()));if(!t)throw new Error(`❌ No method found ${JSON.stringify(S.map((e=>e.type)))}`);return t}(this.options),this.closed=!1,this._isListening=!1,this._onMessageListener=null,this._addEventListeners={message:[],internal:[]},this._unSendMessagePromises=new Set,this._beforeClose=[],this._preparePromises=null,function(e){const t=e.method.create(e.name,e.options);n=t,n&&"function"==typeof n.then?(e._preparePromises=t,t.then((t=>{e._state=t}))):e._state=t;var n}(this)}postMessage(e){if(this.closed)throw new Error("❌ Cannot post message after channel has closed");return C(this,"message",e)}postInternal(e){return C(this,"internal",e)}set onmessage(e){const t={time:this.method.microSeconds(),fn:e};R(this,"message",this._onMessageListener),e&&"function"==typeof e?(this._onMessageListener=t,N(this,"message",t)):this._onMessageListener=null}get onmessage(){return this._onMessageListener}addEventListener(e,t){N(this,e,{time:this.method.microSeconds(),fn:t})}removeEventListener(e,t){R(this,e,this._addEventListeners[e].find((e=>e.fn===t)))}close(){if(this.closed)return;this.closed=!0;const e=this._preparePromises?this._preparePromises:Promise.resolve();return this._onMessageListener=null,this._addEventListeners.message=[],e.then((()=>Promise.all(Array.from(this._unSendMessagePromises)))).then((()=>Promise.all(this._beforeClose.map((e=>e()))))).then((()=>this.method.close(this._state)))}get type(){return this.method.type}isClosed(){return this.closed}}function C(e,t,n){const s={time:e.method.microSeconds(),type:t,data:n};return(e._preparePromises?e._preparePromises:Promise.resolve()).then((()=>{const t=e.method.postMessage(e._state,s);return e._unSendMessagePromises.add(t),t.catch().then((()=>e._unSendMessagePromises.delete(t))),t}))}function B(e){return e._addEventListeners.message.length>0||e._addEventListeners.internal.length>0}function N(e,t,n){e._addEventListeners[t].push(n),function(e){if(!e._isListening&&B(e)){const t=t=>{e._addEventListeners[t.type].forEach((e=>{t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._preparePromises?e._preparePromises.then((()=>{e._isListening=!0,e.method.onMessage(e._state,t,n)})):(e._isListening=!0,e.method.onMessage(e._state,t,n))}}(e)}function R(e,t,n){e._addEventListeners[t]=e._addEventListeners[t].filter((e=>e!==n)),function(e){if(e._isListening&&!B(e)){e._isListening=!1;const t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}class j{constructor(e,t){this._channel=e,this._options=t,this.isLeader=!1,this.isDead=!1,this.token=_(),this._isApplying=!1,this._reApply=!1,this._unloadFns=[],this._listeners=[],this._intervals=[],this._duplicateListeners=()=>{},this._duplicateCalled=!1,this._onBeforeDie=async()=>{};const n=async()=>this.die();m&&(window.addEventListener("beforeUnload",n),window.addEventListener("unload",n),this._unloadFns.push(["beforeUnload",n]),this._unloadFns.push(["unload",n]))}applyOnce(){if(this.isLeader)return Promise.resolve(!1);if(this.isDead)return Promise.resolve(!1);if(this._isApplying)return this._reApply=!0,Promise.resolve(!1);this._isApplying=!0;let e=!1;const t=t=>{"leader"===t.context&&t.token!==this.token&&("apply"===t.action&&t.token>this.token&&(e=!0),"tell"===t.action&&(e=!0))};return this._channel.addEventListener("internal",t),x(this,"apply").then((()=>y(this._options.responseTime))).then((()=>e?Promise.reject(new Error):x(this,"apply"))).then((()=>y(this._options.responseTime))).then((()=>e?Promise.reject(new Error):x(this))).then((()=>function(e){e.isLeader=!0;const t=t=>{"leader"===t.context&&"apply"===t.action&&x(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._duplicateCalled||(e._duplicateCalled=!0,e._duplicateListeners(),x(e,"tell"))};return e._channel.addEventListener("internal",t),e._listeners.push(t),x(e,"tell")}(this))).then((()=>!0)).catch((()=>!1)).then((e=>(this._channel.removeEventListener("internal",t),this._isApplying=!1,!e&&this._reApply?(this._reApply=!1,this.applyOnce()):e)))}awaitLeadership(){var e;return this._awaitLeadershipPromise||(this._awaitLeadershipPromise=(e=this).isLeader?Promise.resolve():new Promise((t=>{let n=!1;function s(){n||(n=!0,d.clearInterval(r),e._channel.removeEventListener("internal",i),t(!0))}e.applyOnce().then((()=>{e.isLeader&&s()}));const r=d.setInterval((()=>{e.applyOnce().then((()=>{e.isLeader&&s()}))}),e._options.fallbackInterval);e._intervals.push(r);const i=t=>{"leader"===t.context&&"death"===t.action&&e.applyOnce().then((()=>{e.isLeader&&s()}))};e._channel.addEventListener("internal",i),e._listeners.push(i)}))),this._awaitLeadershipPromise}set onDuplicate(e){this._duplicateListeners=e}get onDuplicate(){return this._duplicateListeners}set onBeforeDie(e){this._onBeforeDie=e}get onBeforeDie(){return this._onBeforeDie}async die(){if(!this.isDead)return this.isDead=!0,await this.onBeforeDie(),this._listeners.forEach((e=>this._channel.removeEventListener("internal",e))),this._intervals.forEach((e=>d.clearInterval(e))),this._unloadFns.forEach((e=>{m&&window.removeEventListener(e[0],e[1])})),x(this,"death")}}function x(e,t){const n={context:"leader",action:t,token:e.token};return e._channel.postInternal(n)}const U=({type:e,channelName:t,fallbackInterval:n,responseTime:s,emitOnAllTabs:r,callbacks:i,start:a,reset:o,pause:l,resume:c})=>{const u=new P(t,{type:e}),h=function(e,t){if(e._leaderElector)throw new Error("❌ MessageChannel already has a leader-elector");const n=new j(e,t);return e._beforeClose.push((async()=>n.die())),e._leaderElector=n,n}(u,{fallbackInterval:n,responseTime:s}),d={};d[h.token]=!1;let m=!1,p=!0;const v=()=>m;h.awaitLeadership().then((()=>{m=!0})),u.addEventListener("message",(([e,t])=>{switch(e){case"register":d[t]=!1;break;case"deregister":delete d[t];break;case"idle":g(t);break;case"active":f(t);break;case"emitIdle":i.onIdle();break;case"emitActive":i.onActive();break;case"start":a(!0);break;case"reset":o(!0);break;case"pause":l(!0);break;case"resume":c(!0)}}));const g=(e=h.token)=>{d[e]=!0;const t=Object.values(d).every((e=>e));!p&&t&&(p=!0,v()?(i.onIdle(),r&&T("emitIdle")):T("idle"))},f=(e=h.token)=>{d[e]=!1;const t=Object.values(d).some((e=>!e));p&&t&&(p=!1,v()?(i.onActive(),r&&T("emitActive")):T("active"))};h.onDuplicate=async()=>await h.die(),h.onBeforeDie=async()=>await T("deregister");const T=async e=>u.postMessage([e,h.token]);return T("register"),{close:async()=>{await h.die(),await u.close()},send:T,isLeader:v,idle:g,active:f,isAllIdle:()=>p,setAllIdle:e=>{p=e}}};class X extends e{constructor(e){if(super(e),this.state={idle:!1,oldDate:+new Date,lastActive:+new Date,lastIdle:null,idleTime:0,remaining:null,pageX:null,pageY:null},this.tId=null,this.eventsBound=!1,this.callbackRefs={},e.debounce>0&&e.throttle>0)throw new Error("onAction can either be throttled or debounced (not both)");e.debounce>0?this._onAction=g(e.onAction,e.debounce):e.throttle>0?this._onAction=f(e.onAction,e.throttle):this._onAction=e.onAction,e.eventsThrottle>0?this.handleEvent=f(this._handleEvent.bind(this),e.eventsThrottle):this.handleEvent=this._handleEvent.bind(this),e.startOnMount&&!e.startManually||(this.state.idle=!0),this._toggleIdleState=this._toggleIdleState.bind(this),this.start=this.start.bind(this),this.reset=this.reset.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.isIdle=this.isIdle.bind(this),this.getRemainingTime=this.getRemainingTime.bind(this),this.getElapsedTime=this.getElapsedTime.bind(this),this.getLastActiveTime=this.getLastActiveTime.bind(this),this.getLastIdleTime=this.getLastIdleTime.bind(this),this.getTotalIdleTime=this.getTotalIdleTime.bind(this),this.getTotalActiveTime=this.getTotalActiveTime.bind(this)}componentDidMount(){const{startOnMount:e,startManually:t}=this.props;this._setupTabManager(),t||(e?this.start():this._bindEvents())}componentDidUpdate(e){e.debounce!==this.props.debounce&&this.props.debounce>0?(this._onAction.cancel&&this._onAction.cancel(),this._onAction=g(this.props.onAction,this.props.debounce)):e.throttle!==this.props.throttle&&this.props.throttle>0?(this._onAction.cancel&&this._onAction.cancel(),this._onAction=f(this.props.onAction,this.props.throttle)):(e.throttle&&0===this.props.throttle||e.debounce&&0===this.props.debounce)&&(this._onAction.cancel&&this._onAction.cancel(),this._onAction=this.props.onAction),e.eventsThrottle!==this.props.eventsThrottle&&(this._unbindEvents(),this.handleEvent=f(this._handleEvent.bind(this),this.props.eventsThrottle),this._bindEvents()),e.timeout!==this.props.timeout&&this.state.idle&&this.reset(),e.onActive!==this.props.onActive&&(this.callbackRefs.onActive=this.props.onActive),e.onIdle!==this.props.onIdle&&(this.callbackRefs.onIdle=this.props.onIdle)}componentWillUnmount(){d.clearTimeout(this.tId),this._unbindEvents(!0),this._onAction.cancel&&this._onAction.cancel(),this.manager&&this.manager.close().catch(console.error)}render(){const{children:e}=this.props;return e||null}_setupTabManager(){const{crossTab:e,onIdle:t,onActive:n}=this.props;if(this.callbackRefs={onIdle:t,onActive:n},e){const{type:t,channelName:n,fallbackInterval:s,responseTime:r,emitOnAllTabs:i}=Object.assign({channelName:"idle-timer",fallbackInterval:2e3,responseTime:100,removeTimeout:6e4,emitOnAllTabs:!1},!0===e?{}:e);this.manager=U({type:t,channelName:n,fallbackInterval:s,responseTime:r,emitOnAllTabs:i,callbacks:this.callbackRefs,start:this.start,reset:this.reset,pause:this.pause,resume:this.resume})}}_bindEvents(){if(!m)return;const{element:e,events:t,passive:n,capture:s}=this.props;this.eventsBound||(t.forEach((t=>{e.addEventListener(t,this.handleEvent,{capture:s,passive:n})})),this.eventsBound=!0)}_unbindEvents(e=!1){if(!m)return;const{element:t,events:n,passive:s,capture:r}=this.props;(this.eventsBound||e)&&(n.forEach((e=>{t.removeEventListener(e,this.handleEvent,{capture:r,passive:s})})),this.eventsBound=!1)}_toggleIdleState(e){this.setState((e=>({idle:!e.idle,lastIdle:e.idle?e.lastIdle:+new Date-this.props.timeout,idleTime:e.idle?e.idleTime+ +new Date-e.lastIdle:e.idleTime})),(()=>{const{onActive:t,onIdle:n,stopOnIdle:s}=this.props,{idle:r}=this.state;r?(s&&(d.clearTimeout(this.tId),this.tId=null,this._unbindEvents()),this.manager?this.manager.idle():n(e)):(this._bindEvents(),this.manager?this.manager.active():t(e))}))}_handleEvent(e){const{remaining:t,pageX:n,pageY:s,idle:r}=this.state,{timeout:i,stopOnIdle:a}=this.props;if(this._onAction(e),t)return;if("mousemove"===e.type){if(e.pageX===n&&e.pageY===s)return;if(void 0===e.pageX&&void 0===e.pageY)return;if(this.getElapsedTime()<200)return}d.clearTimeout(this.tId),this.tId=null;const o=+new Date-this.getLastActiveTime();(r&&!a||!r&&o>i)&&this._toggleIdleState(e),this.setState({lastActive:+new Date,pageX:e.pageX,pageY:e.pageY}),r&&a||(this.tId=d.setTimeout(this._toggleIdleState,i))}start(e=!0){d.clearTimeout(this.tId),this.tId=null,this._bindEvents(),this.setState({idle:!1,oldDate:+new Date,lastActive:+new Date,remaining:null}),this.manager&&(this.manager.setAllIdle(!1),!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("start"));const{timeout:t}=this.props;this.tId=d.setTimeout(this._toggleIdleState,t)}reset(e=!1){d.clearTimeout(this.tId),this.tId=null,this._bindEvents(),this.state.idle&&(this.manager?this.manager.active():this.props.onActive()),this.manager&&(this.manager.setAllIdle(!1),!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("reset")),this.setState({idle:!1,oldDate:+new Date,lastActive:+new Date,remaining:null});const{timeout:t}=this.props;this.tId=d.setTimeout(this._toggleIdleState,t)}pause(e=!1){const{remaining:t}=this.state;null===t&&(this._unbindEvents(),d.clearTimeout(this.tId),this.tId=null,this.manager&&!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("pause"),this.setState({remaining:this.getRemainingTime()}))}resume(e=!1){const{remaining:t,idle:n}=this.state;null!==t&&(this._bindEvents(),this.manager&&!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("resume"),n||(this.tId=d.setTimeout(this._toggleIdleState,t),this.setState({remaining:null,lastActive:+new Date})))}getRemainingTime(){const{remaining:e,lastActive:t}=this.state,{timeout:n}=this.props;if(null!==e)return e<0?0:e;const s=n-(+new Date-t);return s<0?0:s}getElapsedTime(){const{oldDate:e}=this.state;return+new Date-e}getLastIdleTime(){const{lastIdle:e}=this.state;return e}getTotalIdleTime(){const{idle:e,lastIdle:t,idleTime:n}=this.state;return e?+new Date-t+n:n}getLastActiveTime(){const{lastActive:e}=this.state;return e}getTotalActiveTime(){return this.getElapsedTime()-this.getTotalIdleTime()}isIdle(){const{idle:e}=this.state;return e}isLeader(){return!this.manager||this.manager.isLeader()}}function Y({timeout:e=12e5,element:r=p,events:i=v,onIdle:a=(()=>{}),onActive:o=(()=>{}),onAction:l=(()=>{}),debounce:c=0,throttle:u=0,eventsThrottle:h=200,startOnMount:T=!0,startManually:b=!1,stopOnIdle:w=!1,capture:_=!0,passive:y=!0,crossTab:I=!1}={}){const A=t(!1),E=t(!0),M=t(+new Date),L=t(null),k=t(null),D=t(null),O=t(null),S=t(null),P=t(null),C=t(0),B=t(!0),N=t(e),R=t(null);I&&(!0===I&&(I={}),I=Object.assign({channelName:"idle-timer",fallbackInterval:2e3,responseTime:100,removeTimeout:6e4,emitOnAllTabs:!1},I));const j=t(a),x=t(o),X=t(l);n((()=>{j.current=a}),[a]),n((()=>{x.current=o}),[o]),n((()=>{X.current=l}),[l]);const Y=s((()=>{function e(e){X.current(e)}return e.cancel&&e.cancel(),c>0?g(e,c):u>0?f(e,u):e}),[u,c]),F=e=>{const t=!E.current;E.current=t,t?(w&&(d.clearTimeout(O.current),O.current=null,J()),P.current=+new Date-N.current,R.current?R.current.idle():j.current(e)):(C.current+=+new Date-P.current,z(),R.current?R.current.active():x.current(e))},W=e=>{if(Y(e),L.current)return;if("mousemove"===e.type){if(e.pageX===k&&e.pageY===D)return;if(void 0===e.pageX&&void 0===e.pageY)return;if($()<200)return}d.clearTimeout(O.current),O.current=null;const t=+new Date-H();(E.current&&!w||!E.current&&t>N.current)&&F(e),S.current=+new Date,k.current=e.pageX,D.current=e.pageY,E.current||(O.current=d.setTimeout(F,N.current))},V=t(W),z=()=>{m&&(A.current||(i.forEach((e=>{r.addEventListener(e,V.current,{capture:_,passive:y})})),A.current=!0))},J=(e=!1)=>{m&&(A.current||e)&&(i.forEach((e=>{r.removeEventListener(e,V.current,{capture:_,passive:y})})),A.current=!1)},G=()=>{if(null!==L.current)return L.current<0?0:L.current;const e=N.current-(+new Date-S.current);return e<0?0:e},$=()=>+new Date-M.current,q=()=>E.current?+new Date-P.current+C.current:C.current,H=()=>S.current,K=(e=!1)=>{d.clearTimeout(O.current),O.current=null,z(),E.current=!1,M.current=+new Date,S.current=+new Date,L.current=null,R.current&&(R.current.setAllIdle(!1),!e&&I.emitOnAllTabs&&R.current.send("start")),O.current=d.setTimeout(F,N.current)},Q=(e=!1)=>{d.clearTimeout(O.current),O.current=null,z(),E.current&&(R.current?R.current.active():x.current()),E.current=!1,M.current=+new Date,S.current=+new Date,L.current=null,R.current&&(R.current.setAllIdle(!1),!e&&I.emitOnAllTabs&&R.current.send("reset")),O.current=d.setTimeout(F,N.current)},Z=(e=!1)=>{null===L.current&&(J(),d.clearTimeout(O.current),O.current=null,L.current=G(),R.current&&!e&&I.emitOnAllTabs&&R.current.send("pause"))},ee=(e=!1)=>{null!==L.current&&(z(),E.current||(O.current=d.setTimeout(F,L.current),L.current=null,S.current=+new Date),R.current&&!e&&I.emitOnAllTabs&&R.current.send("resume"))};return n((()=>{if(c>0&&u>0)throw new Error("onAction can either be throttled or debounced (not both)");return I&&(R.current=U({type:I.type,channelName:I.channelName,fallbackInterval:I.fallbackInterval,responseTime:I.responseTime,emitOnAllTabs:I.emitOnAllTabs,callbacks:{onIdle:j.current,onActive:x.current},start:K,reset:Q,pause:Z,resume:ee})),b?async()=>{d.clearTimeout(O.current),J(!0),I&&await R.current.close()}:(T?K():z(),async()=>{d.clearTimeout(O.current),J(!0),Y.cancel&&Y.cancel(),I&&await R.current.close()})}),[]),n((()=>{const e=A.current;e&&J(),V.current=h>0?f(W,h):W,e&&z()}),[h]),n((()=>{N.current=e,!B.current&&E.current&&Q(),B.current=!1}),[e]),{isIdle:()=>E.current,isLeader:()=>!R.current||R.current.isLeader(),start:K,pause:Z,reset:Q,resume:ee,getLastIdleTime:()=>P.current,getTotalIdleTime:q,getLastActiveTime:H,getTotalActiveTime:()=>$()-q(),getElapsedTime:$,getRemainingTime:G}}X.propTypes={timeout:r.number,events:r.arrayOf(r.string),onIdle:r.func,onActive:r.func,onAction:r.func,debounce:r.number,throttle:r.number,eventsThrottle:r.number,element:r.oneOfType([r.object,r.element]),startOnMount:r.bool,startManually:r.bool,stopOnIdle:r.bool,passive:r.bool,capture:r.bool,crossTab:r.oneOfType([r.bool,r.shape({type:r.oneOf(["broadcastChannel","localStorage","simulate"]),channelName:r.string,fallbackInterval:r.number,responseTime:r.number,removeTimeout:r.number,emitOnAllTabs:r.bool})])},X.defaultProps={timeout:12e5,element:p,events:v,onIdle:()=>{},onActive:()=>{},onAction:()=>{},debounce:0,throttle:0,eventsThrottle:200,startOnMount:!0,startManually:!1,stopOnIdle:!1,capture:!0,passive:!0,crossTab:!1},Y.propTypes={timeout:r.number,events:r.arrayOf(r.string),onIdle:r.func,onActive:r.func,onAction:r.func,debounce:r.number,throttle:r.number,eventsThrottle:r.number,element:r.oneOfType([r.object,r.element]),startOnMount:r.bool,startManually:r.bool,stopOnIdle:r.bool,passive:r.bool,capture:r.bool,crossTab:r.oneOfType([r.bool,r.shape({type:r.oneOf(["broadcastChannel","localStorage","simulate"]),channelName:r.string,fallbackInterval:r.number,responseTime:r.number,removeTimeout:r.number,emitOnAllTabs:r.bool})])},Y.defaultProps={timeout:12e5,element:p,events:v,onIdle:()=>{},onActive:()=>{},onAction:()=>{},debounce:0,throttle:0,eventsThrottle:200,startOnMount:!0,startManually:!1,stopOnIdle:!1,capture:!0,passive:!0,crossTab:!1};export default X;export{Y as useIdleTimer};
//# sourceMappingURL=modern.js.map
