"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/classCallCheck"),t=require("@babel/runtime/helpers/createClass"),n=require("@babel/runtime/helpers/assertThisInitialized"),r=require("@babel/runtime/helpers/inherits"),i=require("@babel/runtime/helpers/possibleConstructorReturn"),a=require("@babel/runtime/helpers/getPrototypeOf"),s=require("react"),o=require("prop-types"),u=require("@babel/runtime/helpers/asyncToGenerator"),l=require("@babel/runtime/helpers/slicedToArray"),c=require("@babel/runtime/regenerator"),d=require("@babel/runtime/helpers/typeof");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=f(e),m=f(t),p=f(n),v=f(r),g=f(i),b=f(a),T=f(o),w=f(u),y=f(l),_=f(c),I=f(d);const k=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,E=new WeakMap;var A;const M=((e,t)=>n=>{const r=t.get(n);let i=void 0===r?n.size:r<1073741824?r+1:0;if(!n.has(i))return e(n,i);if(n.size<536870912){for(;n.has(i);)i=Math.floor(1073741824*Math.random());return e(n,i)}if(n.size>k)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;n.has(i);)i=Math.floor(Math.random()*k);return e(n,i)})((A=E,(e,t)=>(A.set(e,t),t)),E);let L=null;const O=((e,t)=>()=>{if(null!==L)return L;const n=new Blob([t],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(n);return L=e(r),L.setTimeout((()=>URL.revokeObjectURL(r)),0),L})((e=>{const t=new Map([[0,()=>{}]]),n=new Map([[0,()=>{}]]),r=new Map,i=new Worker(e);i.addEventListener("message",(({data:e})=>{if(void 0!==(i=e).method&&"call"===i.method){const{params:{timerId:i,timerType:a}}=e;if("interval"===a){const e=t.get(i);if("number"==typeof e){const t=r.get(e);if(void 0===t||t.timerId!==i||t.timerType!==a)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===a){const e=n.get(i);if("number"==typeof e){const t=r.get(e);if(void 0===t||t.timerId!==i||t.timerType!==a)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),n.delete(i)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:i}=e,a=r.get(i);if(void 0===a)throw new Error("The timer is in an undefined state.");const{timerId:s,timerType:o}=a;r.delete(i),"interval"===o?t.delete(s):n.delete(s)}}var i}));return{clearInterval:e=>{const n=M(r);r.set(n,{timerId:e,timerType:"interval"}),t.set(e,n),i.postMessage({id:n,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=M(r);r.set(t,{timerId:e,timerType:"timeout"}),n.set(e,t),i.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,n)=>{const r=M(t);return t.set(r,(()=>{e(),"function"==typeof t.get(r)&&i.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:r,timerType:"interval"}})})),i.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:r,timerType:"interval"}}),r},setTimeout:(e,t)=>{const r=M(n);return n.set(r,e),i.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:r,timerType:"timeout"}}),r}}}),'(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();');var D=!!window.Worker&&"undefined"!=typeof Worker,S={};S.clearInterval=function(e){var t;D?(t=e,O().clearInterval(t)):clearInterval(e)},S.clearTimeout=function(e){var t;D?(t=e,O().clearTimeout(t)):clearTimeout(e)},S.setInterval=function(e,t){D?((e,t)=>{O().setInterval(e,t)})(e,t):setInterval(e,t)},S.setTimeout=function(e,t){D?((e,t)=>{O().setTimeout(e,t)})(e,t):setTimeout(e,t)};var R="object"===("undefined"==typeof window||"undefined"==typeof window?"undefined":I.default(window)),P=R?document:{},x=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange"];function C(e,t){var n;function r(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];n&&S.clearTimeout(n),n=S.setTimeout((function(){e.apply(void 0,i),n=null}),t)}return r.cancel=function(){S.clearTimeout(n)},r}function B(e,t){var n=0;return function(){var r=(new Date).getTime();if(!(r-n<t))return n=r,e.apply(void 0,arguments)}}var N=0,j=0;function q(){var e=(new Date).getTime();return e===N?1e3*e+ ++j:(N=e,j=0,1e3*e)}function U(){return Math.random().toString(36).substring(2)}function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return S.setTimeout(t,e)}))}function Y(){return(new Date).getTime()}var F={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e)};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close()},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(e){return Promise.reject(e)}},canBeUsed:function(){return"function"==typeof BroadcastChannel},type:"broadcastChannel",averageResponseTime:function(){return 150},microSeconds:q},W=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4;h.default(this,e),this.ttl=t,this.set=new Set,this.timeMap=new Map}return m.default(e,[{key:"has",value:function(e){return this.set.has(e)}},{key:"add",value:function(e){this.timeMap.set(e,Y()),this.set.add(e),this._removeTooOldValues()}},{key:"clear",value:function(){this.set.clear(),this.timeMap.clear()}},{key:"_removeTooOldValues",value:function(){for(var e=Y()-this.ttl,t=this.set[Symbol.iterator]();;){var n=t.next().value;if(!n)return;if(!(this.timeMap.get(n)<e))return;this.timeMap.delete(n),this.set.delete(n)}}}]),e}();function z(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function V(e,t){var n=e,r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}function G(){var e=z();if(!e)return!1;try{var t="__check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var J={create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!G())throw new Error("❌ localStorage cannot be used.");var n=U(),r=new W(t.removeTimeout),i={channelName:e,uuid:n,eMIs:r};return i.listener=V(e,(function(e){i.messagesCallback&&e.uuid!==n&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<i.messagesCallbackTime||(r.add(e.token),i.messagesCallback(e.data)))})),i},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){var r=e.channelName,i={token:U(),time:(new Date).getTime(),data:t,uuid:e.uuid},a=JSON.stringify(i);z().setItem(r,a);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=a,window.dispatchEvent(s),n()}))},canBeUsed:G,type:"localStorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:q},H=new Set;var K={create:function(e){var t={name:e,messagesCallback:null};return H.add(t),t},close:function(e){H.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return S.setTimeout((function(){Array.from(H).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:q},Q=[F,J];function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.type){if("simulate"===e.type)return K;var t=Q.find((function(t){return t.type===e.type}));if(t)return t;throw new Error("❌ Method ".concat(e.type," is not supported."))}var n=Q.find((function(e){return e.canBeUsed()}));if(!n)throw new Error("❌ No method found ".concat(JSON.stringify(Q.map((function(e){return e.type})))));return n}var $=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h.default(this,e),this.name=t,this.options=n,this.method=Z(this.options),this.closed=!1,this._isListening=!1,this._onMessageListener=null,this._addEventListeners={message:[],internal:[]},this._unSendMessagePromises=new Set,this._beforeClose=[],this._preparePromises=null,te(this)}return m.default(e,[{key:"postMessage",value:function(e){if(this.closed)throw new Error("❌ Cannot post message after channel has closed");return ee(this,"message",e)}},{key:"postInternal",value:function(e){return ee(this,"internal",e)}},{key:"onmessage",get:function(){return this._onMessageListener},set:function(e){var t={time:this.method.microSeconds(),fn:e};ie(this,"message",this._onMessageListener),e&&"function"==typeof e?(this._onMessageListener=t,re(this,"message",t)):this._onMessageListener=null}},{key:"addEventListener",value:function(e,t){re(this,e,{time:this.method.microSeconds(),fn:t})}},{key:"removeEventListener",value:function(e,t){ie(this,e,this._addEventListeners[e].find((function(e){return e.fn===t})))}},{key:"close",value:function(){var e=this;if(!this.closed){this.closed=!0;var t=this._preparePromises?this._preparePromises:Promise.resolve();return this._onMessageListener=null,this._addEventListeners.message=[],t.then((function(){return Promise.all(Array.from(e._unSendMessagePromises))})).then((function(){return Promise.all(e._beforeClose.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}}},{key:"type",get:function(){return this.method.type}},{key:"isClosed",value:function(){return this.closed}}]),e}();function ee(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._preparePromises?e._preparePromises:Promise.resolve()).then((function(){var t=e.method.postMessage(e._state,r);return e._unSendMessagePromises.add(t),t.catch().then((function(){return e._unSendMessagePromises.delete(t)})),t}))}function te(e){var t,n=e.method.create(e.name,e.options);(t=n)&&"function"==typeof t.then?(e._preparePromises=n,n.then((function(t){e._state=t}))):e._state=n}function ne(e){return e._addEventListeners.message.length>0||e._addEventListeners.internal.length>0}function re(e,t,n){e._addEventListeners[t].push(n),function(e){if(!e._isListening&&ne(e)){var t=function(t){e._addEventListeners[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._preparePromises?e._preparePromises.then((function(){e._isListening=!0,e.method.onMessage(e._state,t,n)})):(e._isListening=!0,e.method.onMessage(e._state,t,n))}}(e)}function ie(e,t,n){e._addEventListeners[t]=e._addEventListeners[t].filter((function(e){return e!==n})),function(e){if(e._isListening&&!ne(e)){e._isListening=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}var ae=function(){function e(t,n){var r=this;h.default(this,e),this._channel=t,this._options=n,this.isLeader=!1,this.isDead=!1,this.token=U(),this._isApplying=!1,this._reApply=!1,this._unloadFns=[],this._listeners=[],this._intervals=[],this._duplicateListeners=function(){},this._duplicateCalled=!1,this._onBeforeDie=w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));var i=function(){var e=w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.die());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();R&&(window.addEventListener("beforeUnload",i),window.addEventListener("unload",i),this._unloadFns.push(["beforeUnload",i]),this._unloadFns.push(["unload",i]))}var t;return m.default(e,[{key:"applyOnce",value:function(){var e=this;if(this.isLeader)return Promise.resolve(!1);if(this.isDead)return Promise.resolve(!1);if(this._isApplying)return this._reApply=!0,Promise.resolve(!1);this._isApplying=!0;var t=!1,n=function(n){"leader"===n.context&&n.token!==e.token&&("apply"===n.action&&n.token>e.token&&(t=!0),"tell"===n.action&&(t=!0))};return this._channel.addEventListener("internal",n),se(this,"apply").then((function(){return X(e._options.responseTime)})).then((function(){return t?Promise.reject(new Error):se(e,"apply")})).then((function(){return X(e._options.responseTime)})).then((function(){return t?Promise.reject(new Error):se(e)})).then((function(){return function(e){e.isLeader=!0;var t=function(t){"leader"===t.context&&"apply"===t.action&&se(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._duplicateCalled||(e._duplicateCalled=!0,e._duplicateListeners(),se(e,"tell"))};return e._channel.addEventListener("internal",t),e._listeners.push(t),se(e,"tell")}(e)})).then((function(){return!0})).catch((function(){return!1})).then((function(t){return e._channel.removeEventListener("internal",n),e._isApplying=!1,!t&&e._reApply?(e._reApply=!1,e.applyOnce()):t}))}},{key:"awaitLeadership",value:function(){var e;return this._awaitLeadershipPromise||(this._awaitLeadershipPromise=(e=this).isLeader?Promise.resolve():new Promise((function(t){var n=!1;function r(){n||(n=!0,S.clearInterval(i),e._channel.removeEventListener("internal",a),t(!0))}e.applyOnce().then((function(){e.isLeader&&r()}));var i=S.setInterval((function(){e.applyOnce().then((function(){e.isLeader&&r()}))}),e._options.fallbackInterval);e._intervals.push(i);var a=function(t){"leader"===t.context&&"death"===t.action&&e.applyOnce().then((function(){e.isLeader&&r()}))};e._channel.addEventListener("internal",a),e._listeners.push(a)}))),this._awaitLeadershipPromise}},{key:"onDuplicate",get:function(){return this._duplicateListeners},set:function(e){this._duplicateListeners=e}},{key:"onBeforeDie",get:function(){return this._onBeforeDie},set:function(e){this._onBeforeDie=e}},{key:"die",value:(t=w.default(_.default.mark((function e(){var t=this;return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDead){e.next=2;break}return e.abrupt("return");case 2:return this.isDead=!0,e.next=5,this.onBeforeDie();case 5:return this._listeners.forEach((function(e){return t._channel.removeEventListener("internal",e)})),this._intervals.forEach((function(e){return S.clearInterval(e)})),this._unloadFns.forEach((function(e){R&&window.removeEventListener(e[0],e[1])})),e.abrupt("return",se(this,"death"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function se(e,t){var n={context:"leader",action:t,token:e.token};return e._channel.postInternal(n)}var oe=function(e){var t=e.type,n=e.channelName,r=e.fallbackInterval,i=e.responseTime,a=e.emitOnAllTabs,s=e.callbacks,o=e.start,u=e.reset,l=e.pause,c=e.resume,d=new $(n,{type:t}),f=function(e,t){if(e._leaderElector)throw new Error("❌ MessageChannel already has a leader-elector");var n=new ae(e,t);return e._beforeClose.push(w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.die());case 1:case"end":return e.stop()}}),e)})))),e._leaderElector=n,n}(d,{fallbackInterval:r,responseTime:i}),h={};h[f.token]=!1;var m=!1,p=!0,v=function(){return m};f.awaitLeadership().then((function(){m=!0})),d.addEventListener("message",(function(e){var t=y.default(e,2),n=t[0],r=t[1];switch(n){case"register":h[r]=!1;break;case"deregister":delete h[r];break;case"idle":g(r);break;case"active":b(r);break;case"emitIdle":s.onIdle();break;case"emitActive":s.onActive();break;case"start":o(!0);break;case"reset":u(!0);break;case"pause":l(!0);break;case"resume":c(!0)}}));var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.token;h[e]=!0;var t=Object.values(h).every((function(e){return e}));!p&&t&&(p=!0,v()?(s.onIdle(),a&&T("emitIdle")):T("idle"))},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.token;h[e]=!1;var t=Object.values(h).some((function(e){return!e}));p&&t&&(p=!1,v()?(s.onActive(),a&&T("emitActive")):T("active"))};f.onDuplicate=w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.die();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),f.onBeforeDie=w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T("deregister");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));var T=function(){var e=w.default(_.default.mark((function e(t){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.postMessage([t,f.token]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.die();case 2:return e.next=4,d.close();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return T("register"),{close:I,send:T,isLeader:v,idle:g,active:b,isAllIdle:function(){return p},setAllIdle:function(e){p=e}}};function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b.default(e);if(t){var i=b.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g.default(this,n)}}var le=function(e){v.default(n,e);var t=ue(n);function n(e){var r;if(h.default(this,n),(r=t.call(this,e)).state={idle:!1,oldDate:+new Date,lastActive:+new Date,lastIdle:null,idleTime:0,remaining:null,pageX:null,pageY:null},r.tId=null,r.eventsBound=!1,r.callbackRefs={},e.debounce>0&&e.throttle>0)throw new Error("onAction can either be throttled or debounced (not both)");return e.debounce>0?r._onAction=C(e.onAction,e.debounce):e.throttle>0?r._onAction=B(e.onAction,e.throttle):r._onAction=e.onAction,e.eventsThrottle>0?r.handleEvent=B(r._handleEvent.bind(p.default(r)),e.eventsThrottle):r.handleEvent=r._handleEvent.bind(p.default(r)),e.startOnMount&&!e.startManually||(r.state.idle=!0),r._toggleIdleState=r._toggleIdleState.bind(p.default(r)),r.start=r.start.bind(p.default(r)),r.reset=r.reset.bind(p.default(r)),r.pause=r.pause.bind(p.default(r)),r.resume=r.resume.bind(p.default(r)),r.isIdle=r.isIdle.bind(p.default(r)),r.getRemainingTime=r.getRemainingTime.bind(p.default(r)),r.getElapsedTime=r.getElapsedTime.bind(p.default(r)),r.getLastActiveTime=r.getLastActiveTime.bind(p.default(r)),r.getLastIdleTime=r.getLastIdleTime.bind(p.default(r)),r.getTotalIdleTime=r.getTotalIdleTime.bind(p.default(r)),r.getTotalActiveTime=r.getTotalActiveTime.bind(p.default(r)),r}return m.default(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.startOnMount,n=e.startManually;this._setupTabManager(),n||(t?this.start():this._bindEvents())}},{key:"componentDidUpdate",value:function(e){e.debounce!==this.props.debounce&&this.props.debounce>0?(this._onAction.cancel&&this._onAction.cancel(),this._onAction=C(this.props.onAction,this.props.debounce)):e.throttle!==this.props.throttle&&this.props.throttle>0?(this._onAction.cancel&&this._onAction.cancel(),this._onAction=B(this.props.onAction,this.props.throttle)):(e.throttle&&0===this.props.throttle||e.debounce&&0===this.props.debounce)&&(this._onAction.cancel&&this._onAction.cancel(),this._onAction=this.props.onAction),e.eventsThrottle!==this.props.eventsThrottle&&(this._unbindEvents(),this.handleEvent=B(this._handleEvent.bind(this),this.props.eventsThrottle),this._bindEvents()),e.timeout!==this.props.timeout&&this.state.idle&&this.reset(),e.onActive!==this.props.onActive&&(this.callbackRefs.onActive=this.props.onActive),e.onIdle!==this.props.onIdle&&(this.callbackRefs.onIdle=this.props.onIdle)}},{key:"componentWillUnmount",value:function(){S.clearTimeout(this.tId),this._unbindEvents(!0),this._onAction.cancel&&this._onAction.cancel(),this.manager&&this.manager.close().catch(console.error)}},{key:"render",value:function(){return this.props.children||null}},{key:"_setupTabManager",value:function(){var e=this.props,t=e.crossTab,n=e.onIdle,r=e.onActive;if(this.callbackRefs={onIdle:n,onActive:r},t){var i=Object.assign({channelName:"idle-timer",fallbackInterval:2e3,responseTime:100,removeTimeout:6e4,emitOnAllTabs:!1},!0===t?{}:t),a=i.type,s=i.channelName,o=i.fallbackInterval,u=i.responseTime,l=i.emitOnAllTabs;this.manager=oe({type:a,channelName:s,fallbackInterval:o,responseTime:u,emitOnAllTabs:l,callbacks:this.callbackRefs,start:this.start,reset:this.reset,pause:this.pause,resume:this.resume})}}},{key:"_bindEvents",value:function(){var e=this;if(R){var t=this.props,n=t.element,r=t.events,i=t.passive,a=t.capture;this.eventsBound||(r.forEach((function(t){n.addEventListener(t,e.handleEvent,{capture:a,passive:i})})),this.eventsBound=!0)}}},{key:"_unbindEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(R){var n=this.props,r=n.element,i=n.events,a=n.passive,s=n.capture;(this.eventsBound||t)&&(i.forEach((function(t){r.removeEventListener(t,e.handleEvent,{capture:s,passive:a})})),this.eventsBound=!1)}}},{key:"_toggleIdleState",value:function(e){var t=this;this.setState((function(e){return{idle:!e.idle,lastIdle:e.idle?e.lastIdle:+new Date-t.props.timeout,idleTime:e.idle?e.idleTime+ +new Date-e.lastIdle:e.idleTime}}),(function(){var n=t.props,r=n.onActive,i=n.onIdle,a=n.stopOnIdle;t.state.idle?(a&&(S.clearTimeout(t.tId),t.tId=null,t._unbindEvents()),t.manager?t.manager.idle():i(e)):(t._bindEvents(),t.manager?t.manager.active():r(e))}))}},{key:"_handleEvent",value:function(e){var t=this.state,n=t.remaining,r=t.pageX,i=t.pageY,a=t.idle,s=this.props,o=s.timeout,u=s.stopOnIdle;if(this._onAction(e),!n){if("mousemove"===e.type){if(e.pageX===r&&e.pageY===i)return;if(void 0===e.pageX&&void 0===e.pageY)return;if(this.getElapsedTime()<200)return}S.clearTimeout(this.tId),this.tId=null;var l=+new Date-this.getLastActiveTime();(a&&!u||!a&&l>o)&&this._toggleIdleState(e),this.setState({lastActive:+new Date,pageX:e.pageX,pageY:e.pageY}),a&&u||(this.tId=S.setTimeout(this._toggleIdleState,o))}}},{key:"start",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];S.clearTimeout(this.tId),this.tId=null,this._bindEvents(),this.setState({idle:!1,oldDate:+new Date,lastActive:+new Date,remaining:null}),this.manager&&(this.manager.setAllIdle(!1),!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("start"));var t=this.props.timeout;this.tId=S.setTimeout(this._toggleIdleState,t)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];S.clearTimeout(this.tId),this.tId=null,this._bindEvents(),this.state.idle&&(this.manager?this.manager.active():this.props.onActive()),this.manager&&(this.manager.setAllIdle(!1),!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("reset")),this.setState({idle:!1,oldDate:+new Date,lastActive:+new Date,remaining:null});var t=this.props.timeout;this.tId=S.setTimeout(this._toggleIdleState,t)}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state.remaining;null===t&&(this._unbindEvents(),S.clearTimeout(this.tId),this.tId=null,this.manager&&!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("pause"),this.setState({remaining:this.getRemainingTime()}))}},{key:"resume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state,n=t.remaining,r=t.idle;null!==n&&(this._bindEvents(),this.manager&&!e&&this.props.crossTab.emitOnAllTabs&&this.manager.send("resume"),r||(this.tId=S.setTimeout(this._toggleIdleState,n),this.setState({remaining:null,lastActive:+new Date})))}},{key:"getRemainingTime",value:function(){var e=this.state,t=e.remaining,n=e.lastActive,r=this.props.timeout;if(null!==t)return t<0?0:t;var i=r-(+new Date-n);return i<0?0:i}},{key:"getElapsedTime",value:function(){var e=this.state.oldDate;return+new Date-e}},{key:"getLastIdleTime",value:function(){return this.state.lastIdle}},{key:"getTotalIdleTime",value:function(){var e=this.state,t=e.idle,n=e.lastIdle,r=e.idleTime;return t?+new Date-n+r:r}},{key:"getLastActiveTime",value:function(){return this.state.lastActive}},{key:"getTotalActiveTime",value:function(){return this.getElapsedTime()-this.getTotalIdleTime()}},{key:"isIdle",value:function(){return this.state.idle}},{key:"isLeader",value:function(){return!this.manager||this.manager.isLeader()}}]),n}(s.Component);function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timeout,n=void 0===t?12e5:t,r=e.element,i=void 0===r?P:r,a=e.events,o=void 0===a?x:a,u=e.onIdle,l=void 0===u?function(){}:u,c=e.onActive,d=void 0===c?function(){}:c,f=e.onAction,h=void 0===f?function(){}:f,m=e.debounce,p=void 0===m?0:m,v=e.throttle,g=void 0===v?0:v,b=e.eventsThrottle,T=void 0===b?200:b,y=e.startOnMount,I=void 0===y||y,k=e.startManually,E=void 0!==k&&k,A=e.stopOnIdle,M=void 0!==A&&A,L=e.capture,O=void 0===L||L,D=e.passive,N=void 0===D||D,j=e.crossTab,q=void 0!==j&&j,U=s.useRef(!1),X=s.useRef(!0),Y=s.useRef(+new Date),F=s.useRef(null),W=s.useRef(null),z=s.useRef(null),V=s.useRef(null),G=s.useRef(null),J=s.useRef(null),H=s.useRef(0),K=s.useRef(!0),Q=s.useRef(n),Z=s.useRef(null);q&&(!0===q&&(q={}),q=Object.assign({channelName:"idle-timer",fallbackInterval:2e3,responseTime:100,removeTimeout:6e4,emitOnAllTabs:!1},q));var $=s.useRef(l),ee=s.useRef(d),te=s.useRef(h);s.useEffect((function(){$.current=l}),[l]),s.useEffect((function(){ee.current=d}),[d]),s.useEffect((function(){te.current=h}),[h]);var ne=s.useMemo((function(){function e(e){te.current(e)}return e.cancel&&e.cancel(),p>0?C(e,p):g>0?B(e,g):e}),[g,p]),re=function(e){var t=!X.current;X.current=t,t?(M&&(S.clearTimeout(V.current),V.current=null,ue()),J.current=+new Date-Q.current,Z.current?Z.current.idle():$.current(e)):(H.current+=+new Date-J.current,se(),Z.current?Z.current.active():ee.current(e))},ie=function(e){if(ne(e),!F.current){if("mousemove"===e.type){if(e.pageX===W&&e.pageY===z)return;if(void 0===e.pageX&&void 0===e.pageY)return;if(ce()<200)return}S.clearTimeout(V.current),V.current=null;var t=+new Date-he();(X.current&&!M||!X.current&&t>Q.current)&&re(e),G.current=+new Date,W.current=e.pageX,z.current=e.pageY,X.current||(V.current=S.setTimeout(re,Q.current))}},ae=s.useRef(ie),se=function(){R&&(U.current||(o.forEach((function(e){i.addEventListener(e,ae.current,{capture:O,passive:N})})),U.current=!0))},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];R&&(U.current||e)&&(o.forEach((function(e){i.removeEventListener(e,ae.current,{capture:O,passive:N})})),U.current=!1)},le=function(){if(null!==F.current)return F.current<0?0:F.current;var e=Q.current-(+new Date-G.current);return e<0?0:e},ce=function(){return+new Date-Y.current},de=function(){return J.current},fe=function(){return X.current?+new Date-J.current+H.current:H.current},he=function(){return G.current},me=function(){return ce()-fe()},pe=function(){return X.current},ve=function(){return!Z.current||Z.current.isLeader()},ge=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];S.clearTimeout(V.current),V.current=null,se(),X.current=!1,Y.current=+new Date,G.current=+new Date,F.current=null,Z.current&&(Z.current.setAllIdle(!1),!e&&q.emitOnAllTabs&&Z.current.send("start")),V.current=S.setTimeout(re,Q.current)},be=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];S.clearTimeout(V.current),V.current=null,se(),X.current&&(Z.current?Z.current.active():ee.current()),X.current=!1,Y.current=+new Date,G.current=+new Date,F.current=null,Z.current&&(Z.current.setAllIdle(!1),!e&&q.emitOnAllTabs&&Z.current.send("reset")),V.current=S.setTimeout(re,Q.current)},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===F.current&&(ue(),S.clearTimeout(V.current),V.current=null,F.current=le(),Z.current&&!e&&q.emitOnAllTabs&&Z.current.send("pause"))},we=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null!==F.current&&(se(),X.current||(V.current=S.setTimeout(re,F.current),F.current=null,G.current=+new Date),Z.current&&!e&&q.emitOnAllTabs&&Z.current.send("resume"))};return s.useEffect((function(){if(p>0&&g>0)throw new Error("onAction can either be throttled or debounced (not both)");return q&&(Z.current=oe({type:q.type,channelName:q.channelName,fallbackInterval:q.fallbackInterval,responseTime:q.responseTime,emitOnAllTabs:q.emitOnAllTabs,callbacks:{onIdle:$.current,onActive:ee.current},start:ge,reset:be,pause:Te,resume:we})),E?w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.clearTimeout(V.current),ue(!0),!q){e.next=5;break}return e.next=5,Z.current.close();case 5:case"end":return e.stop()}}),e)}))):(I?ge():se(),w.default(_.default.mark((function e(){return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.clearTimeout(V.current),ue(!0),ne.cancel&&ne.cancel(),!q){e.next=6;break}return e.next=6,Z.current.close();case 6:case"end":return e.stop()}}),e)}))))}),[]),s.useEffect((function(){var e=U.current;e&&ue(),ae.current=T>0?B(ie,T):ie,e&&se()}),[T]),s.useEffect((function(){Q.current=n,!K.current&&X.current&&be(),K.current=!1}),[n]),{isIdle:pe,isLeader:ve,start:ge,pause:Te,reset:be,resume:we,getLastIdleTime:de,getTotalIdleTime:fe,getLastActiveTime:he,getTotalActiveTime:me,getElapsedTime:ce,getRemainingTime:le}}le.propTypes={timeout:T.default.number,events:T.default.arrayOf(T.default.string),onIdle:T.default.func,onActive:T.default.func,onAction:T.default.func,debounce:T.default.number,throttle:T.default.number,eventsThrottle:T.default.number,element:T.default.oneOfType([T.default.object,T.default.element]),startOnMount:T.default.bool,startManually:T.default.bool,stopOnIdle:T.default.bool,passive:T.default.bool,capture:T.default.bool,crossTab:T.default.oneOfType([T.default.bool,T.default.shape({type:T.default.oneOf(["broadcastChannel","localStorage","simulate"]),channelName:T.default.string,fallbackInterval:T.default.number,responseTime:T.default.number,removeTimeout:T.default.number,emitOnAllTabs:T.default.bool})])},le.defaultProps={timeout:12e5,element:P,events:x,onIdle:function(){},onActive:function(){},onAction:function(){},debounce:0,throttle:0,eventsThrottle:200,startOnMount:!0,startManually:!1,stopOnIdle:!1,capture:!0,passive:!0,crossTab:!1},ce.propTypes={timeout:T.default.number,events:T.default.arrayOf(T.default.string),onIdle:T.default.func,onActive:T.default.func,onAction:T.default.func,debounce:T.default.number,throttle:T.default.number,eventsThrottle:T.default.number,element:T.default.oneOfType([T.default.object,T.default.element]),startOnMount:T.default.bool,startManually:T.default.bool,stopOnIdle:T.default.bool,passive:T.default.bool,capture:T.default.bool,crossTab:T.default.oneOfType([T.default.bool,T.default.shape({type:T.default.oneOf(["broadcastChannel","localStorage","simulate"]),channelName:T.default.string,fallbackInterval:T.default.number,responseTime:T.default.number,removeTimeout:T.default.number,emitOnAllTabs:T.default.bool})])},ce.defaultProps={timeout:12e5,element:P,events:x,onIdle:function(){},onActive:function(){},onAction:function(){},debounce:0,throttle:0,eventsThrottle:200,startOnMount:!0,startManually:!1,stopOnIdle:!1,capture:!0,passive:!0,crossTab:!1},exports.default=le,exports.useIdleTimer=ce;
//# sourceMappingURL=index.min.js.map
